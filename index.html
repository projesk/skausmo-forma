<!DOCTYPE html>
<html lang="lt">
<head>
  <meta charset="UTF-8" />
  <title>Skausmo vertinimo forma</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <style>
    body{font-family:Arial,sans-serif;padding:1rem;max-width:860px;margin:auto}
    h2{color:#663399;margin:0 0 .5rem}
    .muted{color:#555;font-size:14px;margin:.25rem 0 1rem}
    .card{border:1px solid #e6e6e6;border-radius:12px;padding:14px;margin:12px 0;background:#fff}
    .row{display:flex;gap:10px;flex-wrap:wrap;align-items:center}
    .pill{display:inline-block;padding:4px 10px;border-radius:999px;font-size:13px;border:1px solid #ddd;background:#fafafa}
    .btn{padding:.65rem 1rem;border:none;border-radius:10px;font-size:16px;cursor:pointer;background:#663399;color:white}
    .btn.secondary{background:#f2f2f2;color:#111;border:1px solid #ddd}
    .btn.danger{background:#b00020}
    .btn:disabled{opacity:.55;cursor:not-allowed}
    .note{font-size:14px;color:#222;line-height:1.4}
    ul{margin:.5rem 0 .25rem 1.1rem}
    .big{font-size:18px;font-weight:700;margin:0 0 .5rem}
    .ok{color:#1b5e20}
    .warn{color:#8a6d00}
    .bad{color:#8b0000}
    .center{text-align:center}
    .hidden{display:none !important}

    /* ===== DVPRS GRID (veidukas + spalva + Å¾odinis apraÅ¡as) ===== */
    .dvprsGrid{
      padding:6px;
      display:grid;
      grid-template-columns:repeat(2,1fr);
      gap:10px;
      margin:12px 0;
    }
    @media(min-width:860px){
      .dvprsGrid{ grid-template-columns:repeat(3,1fr); }
    }
    .dvprsCard{
      border:1px solid #e6e6e6;
      border-radius:14px;
      padding:12px;
      background:#fff;
      cursor:pointer;
      text-align:left;
      overflow:hidden;
      min-height:120px;
    }
    .dvprsCard:active{ transform:scale(0.99); }
    .dvprsBar{
      height:10px;
      border-radius:999px;
      margin-bottom:10px;
      background-color: var(--dvprsColor, #e5e7eb);
    }
    .dvprsTop{ display:flex; align-items:center; justify-content:space-between; gap:10px; }
    .dvprsLeft{ display:flex; align-items:center; gap:10px; }
    .dvprsEmoji{ font-size:26px; line-height:1; }
    .dvprsNum{ font-size:24px; font-weight:900; line-height:1; }
    .dvprsTag{ font-size:12px; color:#666; white-space:nowrap; }
    .dvprsText{
      margin-top:10px;
      font-size:13px;
      line-height:1.25;
      font-weight:700;
      color:#111;
    }
    .dvprsCard.selected{
      outline:3px solid rgba(102,51,153,.35);
      border-color: rgba(102,51,153,.35);
    }

    .sources{
      margin-top:10px;
      font-size:12px;
      color:#555;
      border-top:1px dashed #e6e6e6;
      padding-top:8px;
    }
  </style>
</head>
<body>
  <h2>Skausmo vertinimo forma</h2>
  <p class="muted">
    <span class="pill"><strong>Lova:</strong> <span id="bed-id">...</span></span>
  </p>

  <!-- 1) Pasirinkimas -->
  <div id="step1" class="card">
    <p class="big">Pasirinkite skausmo lygÄ¯ nuo 0 iki 10</p>

    <!-- DVPRS kortelÄ—s sugeneruojamos JS -->
    <div id="dvprsGrid" class="dvprsGrid"></div>

    <div class="center">
      <button id="toStep2" class="btn" disabled>Toliau</button>
    </div>
  </div>

  <!-- 2) Atsakas + (vaistai -> alergija) -->
  <div id="step2" class="card hidden">
    <p class="big">JÅ«sÅ³ Ä¯vertinimas: <span id="painOut"></span>/10</p>
    <div id="adviceBox" class="note"></div>

    <!-- tik jei 1â€“3 -->
    <div id="medsBox" class="hidden" style="margin-top:12px">
      <p class="note"><strong>Jei vis tiek reikia:</strong></p>
      <button id="wantMedsBtn" class="btn danger" type="button">Noriu vaistÅ³ nuo skausmo</button>
      <p class="muted" id="medsStatus" style="margin-top:6px"></p>
    </div>

    <hr style="border:none;border-top:1px solid #eee;margin:14px 0">

    <!-- Alergija rodoma TIK kai pacientas paspaudÅ¾ia "Noriu vaistÅ³" -->
    <div id="allergyBlock" class="hidden">
      <p class="note">
        <strong>Ar esate alergiÅ¡kas/-a kokiems nors vaistams nuo skausmo?</strong>
        <span class="muted">(pvz., ibuprofenui, ketoprofenui, paracetamoliui)</span>
      </p>

      <div class="row" style="margin-top:8px">
        <button class="btn secondary" id="allergyNo" type="button">Ne</button>
        <button class="btn danger" id="allergyYes" type="button">Taip</button>
      </div>

      <p class="muted" id="allergyStatus" style="margin-top:10px"></p>
    </div>

    <div class="center" style="margin-top:12px">
      <button id="submitBtn" class="btn">Pateikti Ä¯vertinimÄ…</button>
    </div>
  </div>

  <!-- 3) Pabaiga -->
  <div id="step3" class="card hidden center">
    <p class="big ok">AÄiÅ«! Ä®vertinimas iÅ¡saugotas.</p>
    <p class="note">Galite uÅ¾daryti Å¡Ä¯ langÄ….</p>
  </div>

  <script>
    // === KonfigÅ«racija ===
    const scriptURL = "https://script.google.com/macros/s/AKfycbw4cdh6miY0FPdhHUaR8CxaRNarh01J1rY_QhCN7A5TTvyDgcDED57jZOBGk0g-m05b_A/exec";

    // === Parametrai ===
    const urlParams = new URLSearchParams(window.location.search);
    const bedId = (urlParams.get("id") || "neÅ¾inoma").trim();
    document.getElementById("bed-id").innerText = bedId;

    // === BÅ«sena ===
    let selectedPain = null;
    let wantMeds = false;   // pacientas paspaudÄ— "noriu vaistÅ³"
    let allergy = null;     // "YES" | "NO" | null (tik jei wantMeds)

    // === Elementai ===
    const toStep2Btn = document.getElementById("toStep2");
    const step1 = document.getElementById("step1");
    const step2 = document.getElementById("step2");
    const step3 = document.getElementById("step3");

    const painOut = document.getElementById("painOut");
    const adviceBox = document.getElementById("adviceBox");

    const medsBox = document.getElementById("medsBox");
    const wantMedsBtn = document.getElementById("wantMedsBtn");
    const medsStatus = document.getElementById("medsStatus");

    const allergyBlock = document.getElementById("allergyBlock");
    const allergyNo = document.getElementById("allergyNo");
    const allergyYes = document.getElementById("allergyYes");
    const allergyStatus = document.getElementById("allergyStatus");

    const submitBtn = document.getElementById("submitBtn");

    // ===== DVPRS (veidukas + spalva + pilnas Å¾odinis apraÅ¡as) =====
    // Jei nori 1:1 su tavo slaugos plano tekstais â€“ pakeisk Äia tekstus identiÅ¡kai.
    const dvprs = [
      { n: 0,  emoji:"ğŸ˜€", color:"#16a34a", text:"NERA SKAUSMO" },

      { n: 1,  emoji:"ğŸ™‚", color:"#22c55e", text:"NEPASTEBIMAS SKAUSMAS" },
      { n: 2,  emoji:"ğŸ™‚", color:"#4ade80", text:"PASTEBIMAS SKAUSMAS, NEKELIANTIS NEPATOGUMÅ²" },

      { n: 3,  emoji:"ğŸ™‚", color:"#86efac", text:"SKAUSMAS, KURIS KARTAIS NELEIDÅ½IA SUSIKAUPTI" },
      { n: 4,  emoji:"ğŸ˜", color:"#facc15", text:"SKAUSMAS, KURIS NELEIDÅ½IA SUSIKAUPTI" },
      { n: 5,  emoji:"ğŸ˜", color:"#fbbf24", text:"SKAUSMAS, KURIS TRUKDO VEIKLOMS" },

      { n: 6,  emoji:"ğŸ˜", color:"#f59e0b", text:"SUNKU IGNORUOTI SKAUSMÄ„" },
      { n: 7,  emoji:"ğŸ˜£", color:"#fb7185", text:"SUNKU SUSIKAUPTI DÄ–L SKAUSMO" },
      { n: 8,  emoji:"ğŸ˜£", color:"#f43f5e", text:"DÄ–L SKAUSMO SUNKU KÄ„ NORS DARYTI" },

      { n: 9,  emoji:"ğŸ˜­", color:"#ef4444", text:"NEPAKELIAMAS SKAUSMAS, NIEKO NEÄ®MANOMA DARYTI" },
      { n: 10, emoji:"ğŸ˜­", color:"#b91c1c", text:"DIDÅ½IAUSIAS SKAUSMAS, NIEKAS DAUGIAU NERÅªPI" }
    ];

    function renderDvprsGrid(){
      const grid = document.getElementById("dvprsGrid");
      grid.innerHTML = dvprs.map(item => `
        <button type="button"
          class="dvprsCard"
          data-n="${item.n}"
          style="--dvprsColor:${item.color}"
          aria-label="Skausmo lygis ${item.n} iÅ¡ 10"
        >
          <div class="dvprsBar"></div>
          <div class="dvprsTop">
            <div class="dvprsLeft">
              <div class="dvprsEmoji" aria-hidden="true">${item.emoji}</div>
              <div class="dvprsNum">${item.n}</div>
            </div>
            <div class="dvprsTag">${item.n}/10</div>
          </div>
          <div class="dvprsText">${item.text}</div>
        </button>
      `).join("");

      grid.querySelectorAll(".dvprsCard").forEach(btn => {
        btn.addEventListener("click", () => {
          const n = parseInt(btn.getAttribute("data-n"), 10);
          if(Number.isNaN(n)) return;

          selectedPain = n;
          toStep2Btn.disabled = false;

          grid.querySelectorAll(".dvprsCard").forEach(b => b.classList.remove("selected"));
          btn.classList.add("selected");
        });
      });
    }

    renderDvprsGrid();

    // === Ä—jimas Ä¯ 2 Å¾ingsnÄ¯ ===
    toStep2Btn.addEventListener("click", () => {
      if (selectedPain === null || Number.isNaN(selectedPain)) return;
      showStep2();
    });

    function showStep2(){
      step1.classList.add("hidden");
      step2.classList.remove("hidden");

      painOut.textContent = selectedPain;

      // reset meds
      wantMeds = false;
      medsStatus.textContent = "";
      allergyBlock.classList.add("hidden");

      // reset alergija
      allergy = null;
      allergyStatus.textContent = "";

      // submit leidÅ¾iam visada (Ä¯vertinimÄ… galima pateikti ir be vaistÅ³)
      submitBtn.disabled = false;
      submitBtn.textContent = "Pateikti Ä¯vertinimÄ…";

      // rekomendacijos pagal slaugos plano kriterijus:
      // 0 â€“ nÄ—ra; 1â€“3 â€“ nedidelis; 4â€“6 â€“ vidutinis; 7â€“10 â€“ didelis
      if(selectedPain === 0){
        adviceBox.innerHTML = `
          <div class="ok"><strong>Skausmo nÄ—ra.</strong></div>
          <div class="note" style="margin-top:6px">
            AÄiÅ«. Jei situacija pasikeistÅ³ â€“ Ä¯vertinkite skausmÄ… dar kartÄ….
          </div>
        `;
        medsBox.classList.add("hidden");
      }
      else if(selectedPain >= 1 && selectedPain <= 3){
        adviceBox.innerHTML = `
          <div class="ok"><strong>Nedidelis skausmas.</strong></div>

          <div class="note" style="margin-top:8px">
            Galite pabandyti nefarmakologines priemones, kurios daÅ¾nai padeda sumaÅ¾inti diskomfortÄ…:
            <ul>
              <li><strong>Patogi padÄ—tis:</strong> pakeiskite kÅ«no padÄ—tÄ¯, pasirÅ«pinkite atrama ar pagalvÄ—le.</li>
              <li><strong>Ramus kvÄ—pavimas:</strong> lÄ—tai ir giliai kvÄ—puokite, stenkitÄ—s atsipalaiduoti.</li>
              <li><strong>DÄ—mesio nukreipimas:</strong> muzika, pokalbis, televizija ar kita rami veikla gali sumaÅ¾inti skausmo pojÅ«tÄ¯.</li>
              <li><strong>Poilsis:</strong> trumpas poilsis daÅ¾nai padeda organizmui atsistatyti.</li>
              <li><strong>Å velnus judÄ—jimas:</strong> jei leidÅ¾iama, lengvas pasijudinimas ar pozos pakeitimas gali sumaÅ¾inti sustingimÄ….</li>
              <li><strong>Å iluma arba vÄ—sa:</strong> kai kuriais atvejais gali padÄ—ti Å¡ilumos ar Å¡alÄio pojÅ«tis (tik jei jums tinka ir yra leidÅ¾iama).</li>
              <li><strong>Rami aplinka:</strong> maÅ¾iau triukÅ¡mo, pritemdyta Å¡viesa ir komfortiÅ¡ka temperatÅ«ra padeda atsipalaiduoti.</li>
            </ul>

            <div class="sources">
              Å altiniai: WHO (World Health Organization) rekomendacijos dÄ—l skausmo valdymo; NICE rekomendacijos dÄ—l skausmo valdymo; APS (American Pain Society) â€“ nefarmakologinÄ—s priemonÄ—s skausmui maÅ¾inti.
            </div>
          </div>
        `;
        medsBox.classList.remove("hidden");
      }
      else if(selectedPain >= 4 && selectedPain <= 6){
        adviceBox.innerHTML = `
          <div class="warn"><strong>Vidutinis skausmas.</strong></div>
          <div class="note" style="margin-top:6px">
            Ä®vertinimas pateiktas. Slaugytoja turÄ—tÅ³ ateiti.
            <br><br>
            Jei skausmas nemaÅ¾Ä—ja arba slaugytoja neateina per <strong>~15 min</strong>,
            spauskite palatos iÅ¡kvietimo mygtukÄ… arba ateikite Ä¯ slaugytojÅ³ postÄ….
          </div>
        `;
        medsBox.classList.add("hidden");
      }
      else { // 7â€“10
        adviceBox.innerHTML = `
          <div class="bad"><strong>Didelis skausmas.</strong></div>
          <div class="note" style="margin-top:6px">
            Ä®vertinimas pateiktas. Slaugytoja turÄ—tÅ³ ateiti <strong>kuo greiÄiau</strong>.
            <br><br>
            Jei slaugytoja neateina per <strong>~10 min</strong>, spauskite palatos iÅ¡kvietimo mygtukÄ…
            arba ateikite Ä¯ slaugytojÅ³ postÄ….
          </div>
        `;
        medsBox.classList.add("hidden");
      }
    }

    // === 1â€“3: "noriu vaistÅ³" -> parodom alergijÄ… ir padarom jÄ… privalomÄ… ===
    wantMedsBtn.addEventListener("click", () => {
      wantMeds = true;
      medsStatus.textContent = "PaÅ¾ymÄ—ta: pageidaujate farmakologinio skausmo malÅ¡inimo.";

      // Parodom alergijos blokÄ…
      allergyBlock.classList.remove("hidden");

      // Dabar prieÅ¡ pateikimÄ… privaloma pasirinkti alergijÄ…
      allergy = null;
      allergyStatus.textContent = "";
      submitBtn.disabled = true;

      // Nuslenkam, kad pacientas iÅ¡kart pamatytÅ³
      allergyBlock.scrollIntoView({ behavior: "smooth", block: "start" });
    });

    // === Alergija (tik kai atidarytas allergyBlock) ===
    allergyNo.addEventListener("click", () => {
      allergy = "NO";
      allergyStatus.textContent = "PaÅ¾ymÄ—ta: alergijos nÄ—ra.";
      submitBtn.disabled = false;
    });

    allergyYes.addEventListener("click", () => {
      allergy = "YES";
      allergyStatus.innerHTML =
        "<strong style='color:#8b0000'>AÄiÅ« uÅ¾ informacijÄ….</strong> " +
        "BÅ«tinai slaugytojai pasakykite, kokiems vaistams turite alergijÄ….";
      submitBtn.disabled = false;
    });

    // === Siuntimas ===
    submitBtn.addEventListener("click", async () => {
      if (selectedPain === null || Number.isNaN(selectedPain)) return;

      // Alergija privaloma tik jei pacientas paspaudÄ— "noriu vaistÅ³"
      if (wantMeds && !allergy) {
        alert("PraÅ¡ome paÅ¾ymÄ—ti, ar turite alergijÄ… vaistams.");
        return;
      }

      submitBtn.disabled = true;
      submitBtn.textContent = "SiunÄiama...";

      const timestamp = new Date().toISOString();

      const qs = new URLSearchParams({
        id: bedId,
        pain: String(selectedPain),
        time: timestamp,
        meds: wantMeds ? "YES" : "NO",
        allergy: wantMeds ? allergy : "NA" // NA = neaktualu (nepraÅ¡Ä— vaistÅ³)
      });

      try {
        await fetch(`${scriptURL}?${qs.toString()}`, { method: "GET" });

        step2.classList.add("hidden");
        step3.classList.remove("hidden");
      } catch (err) {
        alert("Klaida! Nepavyko iÅ¡saugoti duomenÅ³. Pabandykite dar kartÄ….");
        submitBtn.disabled = false;
        submitBtn.textContent = "Pateikti Ä¯vertinimÄ…";
      }
    });
  </script>
</body>
</html>

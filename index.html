
<!DOCTYPE html>
<html lang="lt">
<head>
  <meta charset="UTF-8" />
  <title>Skausmo vertinimo forma</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <style>
    body{font-family:Arial,sans-serif;padding:1rem;max-width:720px;margin:auto}
    h2{color:#663399;margin:0 0 .5rem}
    .muted{color:#555;font-size:14px;margin:.25rem 0 1rem}
    .card{border:1px solid #e6e6e6;border-radius:12px;padding:14px;margin:12px 0;background:#fff}
    .row{display:flex;gap:10px;flex-wrap:wrap;align-items:center}
    .pill{display:inline-block;padding:4px 10px;border-radius:999px;font-size:13px;border:1px solid #ddd;background:#fafafa}
    .pain-scale{display:flex;flex-wrap:wrap;gap:10px;justify-content:center;margin:12px 0}
    .pain-scale label{flex:0 0 62px;text-align:center;font-size:14px;padding:10px;border-radius:10px;border:1px solid rgba(0,0,0,.06);user-select:none;cursor:pointer}
    .pain-scale input{margin-top:6px}
    .face{font-size:20px;display:block}
    .level-0-3{background:#b6e2a1}
    .level-4-6{background:#fff5a1}
    .level-7-9{background:#f8b4a1}
    .level-10{background:#f36b6b}
    .btn{
      padding:.65rem 1rem;border:none;border-radius:10px;font-size:16px;cursor:pointer;
      background:#663399;color:white
    }
    .btn.secondary{background:#f2f2f2;color:#111;border:1px solid #ddd}
    .btn.danger{background:#b00020}
    .btn:disabled{opacity:.55;cursor:not-allowed}
    .note{font-size:14px;color:#222;line-height:1.35}
    ul{margin:.5rem 0 .25rem 1.1rem}
    .big{font-size:18px;font-weight:700;margin:0 0 .5rem}
    .ok{color:#1b5e20}
    .warn{color:#8a6d00}
    .bad{color:#8b0000}
    .center{text-align:center}
    .hidden{display:none !important}
  </style>
</head>
<body>
  <h2>Skausmo vertinimo forma</h2>
  <p class="muted">
    <span class="pill"><strong>Lova:</strong> <span id="bed-id">...</span></span>
  </p>

  <!-- 1) Pasirinkimas -->
  <div id="step1" class="card">
    <p class="big">Pasirinkite skausmo lygÄ¯ nuo 0 iki 10</p>
    <div class="pain-scale" id="pain-scale">
      <label class="level-0-3"><span class="face">ğŸ˜Š</span><input type="radio" name="pain" value="0">0</label>
      <label class="level-0-3"><span class="face">ğŸ™‚</span><input type="radio" name="pain" value="1">1</label>
      <label class="level-0-3"><span class="face">ğŸ™‚</span><input type="radio" name="pain" value="2">2</label>
      <label class="level-0-3"><span class="face">ğŸ˜</span><input type="radio" name="pain" value="3">3</label>
      <label class="level-4-6"><span class="face">ğŸ˜•</span><input type="radio" name="pain" value="4">4</label>
      <label class="level-4-6"><span class="face">ğŸ˜•</span><input type="radio" name="pain" value="5">5</label>
      <label class="level-4-6"><span class="face">ğŸ˜£</span><input type="radio" name="pain" value="6">6</label>
      <label class="level-7-9"><span class="face">ğŸ˜–</span><input type="radio" name="pain" value="7">7</label>
      <label class="level-7-9"><span class="face">ğŸ˜«</span><input type="radio" name="pain" value="8">8</label>
      <label class="level-7-9"><span class="face">ğŸ˜­</span><input type="radio" name="pain" value="9">9</label>
      <label class="level-10"><span class="face">ğŸ†˜</span><input type="radio" name="pain" value="10">10</label>
    </div>

    <div class="center">
      <button id="toStep2" class="btn" disabled>Toliau</button>
    </div>
  </div>

  <!-- 2) Atsakas + alergija -->
  <div id="step2" class="card hidden">
    <p class="big">JÅ«sÅ³ Ä¯vertinimas: <span id="painOut"></span>/10</p>
    <div id="adviceBox" class="note"></div>

    <!-- tik jei 0-3 -->
    <div id="medsBox" class="hidden" style="margin-top:10px">
      <p class="note"><strong>Jei vis tiek reikia:</strong></p>
      <button id="wantMedsBtn" class="btn danger" type="button">Noriu vaistÅ³ nuo skausmo</button>
      <p class="muted" id="medsStatus" style="margin-top:6px"></p>
    </div>

    <hr style="border:none;border-top:1px solid #eee;margin:14px 0">

    <p class="note">
      <strong>Ar esate alergiÅ¡kas/-a kokiems nors vaistams nuo skausmo?</strong>
      <span class="muted">(pvz., ibuprofenui, ketoprofenui, paracetamoliui)</span>
    </p>

    <div class="row" style="margin-top:8px">
      <button class="btn secondary" id="allergyNo" type="button">Ne</button>
      <button class="btn danger" id="allergyYes" type="button">Taip</button>
    </div>

    <p class="muted" id="allergyStatus" style="margin-top:10px"></p>

    <div class="center" style="margin-top:12px">
      <button id="submitBtn" class="btn" disabled>Pateikti Ä¯vertinimÄ…</button>
    </div>
  </div>

  <!-- 3) Pabaiga -->
  <div id="step3" class="card hidden center">
    <p class="big ok">AÄiÅ«! Ä®vertinimas iÅ¡saugotas.</p>
    <p class="note">Galite uÅ¾daryti Å¡Ä¯ langÄ….</p>
  </div>

  <script>
    // --- KonfigÅ«racija ---
    const scriptURL = "https://script.google.com/macros/s/AKfycbw4cdh6miY0FPdhHUaR8CxaRNarh01J1rY_QhCN7A5TTvyDgcDED57jZOBGk0g-m05b_A/exec";

    // --- Parametrai ---
    const urlParams = new URLSearchParams(window.location.search);
    const bedId = (urlParams.get("id") || "neÅ¾inoma").trim();
    document.getElementById("bed-id").innerText = bedId;

    // --- BÅ«sena ---
    let selectedPain = null;
    let wantMeds = false;
    let allergy = null; // "YES" | "NO" | null

    const toStep2Btn = document.getElementById("toStep2");
    const step1 = document.getElementById("step1");
    const step2 = document.getElementById("step2");
    const step3 = document.getElementById("step3");

    const painOut = document.getElementById("painOut");
    const adviceBox = document.getElementById("adviceBox");

    const medsBox = document.getElementById("medsBox");
    const wantMedsBtn = document.getElementById("wantMedsBtn");
    const medsStatus = document.getElementById("medsStatus");

    const allergyNo = document.getElementById("allergyNo");
    const allergyYes = document.getElementById("allergyYes");
    const allergyStatus = document.getElementById("allergyStatus");

    const submitBtn = document.getElementById("submitBtn");

    // --- 1) pasirinktas skausmas ---
    document.getElementById("pain-scale").addEventListener("change", (e) => {
      if (e.target && e.target.name === "pain") {
        selectedPain = parseInt(e.target.value, 10);
        toStep2Btn.disabled = Number.isNaN(selectedPain);
      }
    });

    toStep2Btn.addEventListener("click", () => {
      if (selectedPain === null || Number.isNaN(selectedPain)) return;
      showStep2();
    });

    function showStep2() {
      step1.classList.add("hidden");
      step2.classList.remove("hidden");

      painOut.textContent = selectedPain;

      // reset alergija / mygtukai kiekvienam kartui
      allergy = null;
      allergyStatus.textContent = "";
      submitBtn.disabled = true;
      allergyNo.classList.remove("danger");
      allergyYes.classList.remove("danger");

      // reset meds
      wantMeds = false;
      medsStatus.textContent = "";

      // patarimai pagal lygÄ¯
      if (selectedPain <= 3) {
        adviceBox.innerHTML = `
          <div class="ok"><strong>Nedidelis skausmas.</strong></div>
          <div class="note" style="margin-top:6px">
            Galite pabandyti nefarmakologines priemones:
            <ul>
              <li>PatogesnÄ— padÄ—tis / pagalvÄ—liÅ³ korekcija</li>
              <li>Ramus kvÄ—pavimas, atsipalaidavimas</li>
              <li>DÄ—mesio nukreipimas (muzika, TV, pokalbis)</li>
            </ul>
          </div>
        `;
        medsBox.classList.remove("hidden");
      } else if (selectedPain <= 6) {
        adviceBox.innerHTML = `
          <div class="warn"><strong>Vidutinis skausmas.</strong></div>
          <div class="note" style="margin-top:6px">
            Ä®vertinimas pateiktas. Slaugytoja turÄ—tÅ³ ateiti.
            <br><br>
            Jei skausmas nemaÅ¾Ä—ja arba slaugytoja neateina per <strong>~15 min</strong>,
            spauskite palatos iÅ¡kvietimo mygtukÄ… arba ateikite Ä¯ slaugytojÅ³ postÄ….
          </div>
        `;
        medsBox.classList.add("hidden");
      } else {
        adviceBox.innerHTML = `
          <div class="bad"><strong>Didelis skausmas.</strong></div>
          <div class="note" style="margin-top:6px">
            Ä®vertinimas pateiktas. Slaugytoja turÄ—tÅ³ ateiti <strong>kuo greiÄiau</strong>.
            <br><br>
            Jei slaugytoja neateina per <strong>~10 min</strong>, spauskite palatos iÅ¡kvietimo mygtukÄ…
            arba ateikite Ä¯ slaugytojÅ³ postÄ….
          </div>
        `;
        medsBox.classList.add("hidden");
      }
    }

    // --- 0-3: noriu vaistÅ³ ---
    wantMedsBtn.addEventListener("click", () => {
      wantMeds = true;
      medsStatus.textContent = "PaÅ¾ymÄ—ta: pageidaujate farmakologinio skausmo malÅ¡inimo.";
    });

    // --- Alergija ---
    allergyNo.addEventListener("click", () => {
      allergy = "NO";
      allergyStatus.textContent = "PaÅ¾ymÄ—ta: alergijos nÄ—ra.";
      submitBtn.disabled = false;
    });

    allergyYes.addEventListener("click", () => {
      allergy = "YES";
      allergyStatus.textContent = "PaÅ¾ymÄ—ta: yra alergija (slaugytoja iÅ¡siaiÅ¡kins detales atÄ—jusi).";
      submitBtn.disabled = false;
    });

    // --- Siuntimas ---
    submitBtn.addEventListener("click", async () => {
      if (selectedPain === null || Number.isNaN(selectedPain)) return;
      if (!allergy) return;

      submitBtn.disabled = true;
      submitBtn.textContent = "SiunÄiama...";

      const timestamp = new Date().toISOString();

      // IÅ¡siunÄiam GET (kaip pas tave buvo), pridedam papildomus laukus.
      const qs = new URLSearchParams({
        id: bedId,
        pain: String(selectedPain),
        time: timestamp,
        allergy: allergy,          // YES / NO
        meds: wantMeds ? "YES" : "NO"
      });

      try {
        await fetch(`${scriptURL}?${qs.toString()}`, { method: "GET" });

        step2.classList.add("hidden");
        step3.classList.remove("hidden");
      } catch (err) {
        alert("Klaida! Nepavyko iÅ¡saugoti duomenÅ³. Pabandykite dar kartÄ….");
        submitBtn.disabled = false;
        submitBtn.textContent = "Pateikti Ä¯vertinimÄ…";
      }
    });
  </script>
</body>
</html>
